{% extends "base_dashboard.html" %} {% block content %}

<style>
  .card-sala {
   cursor: pointer;
        transition: transform 0.2s;
        aspect-ratio: 1 / 1;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
  }

  /* Anima√ß√£o de crescimento configurada corretamente */
  .card-sala:hover {
    transform: scale(1.03);
  }
</style>

<div class="container my-5">
  <h2 class="text-center mb-5">Todas as Salas</h2>

  <div class="d-flex justify-content-end mb-4">
    {% if tipo_usuario == 'ADMINISTRADOR' %}
    <button
      class="btn btn-primary"
      type="button"
      data-coreui-toggle="modal"
      data-coreui-target="#modalCadastroSala"
    >
      <i class="c-icon cil-plus"></i> Nova Sala
    </button>
    {% endif %}
  </div>

  <div class="row row-cols-2 row-cols-md-3 row-cols-lg-5 g-4">
    {% for sala in salas %}
    <div class="col">
      <div
        class="card card-sala text-center border-0 bg-light"
        style="cursor: pointer; min-height: 150px"
        data-sala-nome="{{ sala.nome }}"
        data-sala-capacidade="{{ sala.capacidade }}"
        data-sala-localizacao="{{ sala.localizacao or 'N√£o Informada' }}"
        data-sala-recursos="{{ sala.recursos or 'Nenhum' }}"
        data-sala-descricao="{{ sala.descricao or 'Nenhuma descri√ß√£o fornecida.' }}"
        data-coreui-toggle="modal"
        data-coreui-target="#modalDetalhesSala"
      >
        <div class="card-body d-flex align-items-center justify-content-center">
          <h5 class="card-title mb-0 text-dark">{{ sala.nome }}</h5>
        </div>
      </div>
    </div>
    {% endfor %} {% if not salas %}
    <div class="col-12">
      <p class="text-center text-muted mt-5">Ainda n√£o h√° salas cadastradas.</p>
    </div>
    {% endif %}
  </div>
  <div
    class="modal fade"
    id="modalCadastroSala"
    tabindex="-1"
    aria-labelledby="modalCadastroSalaLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="formCadastroSala">
          <div class="modal-header">
            <h5 class="modal-title" id="modalCadastroSalaLabel">
              üìù Cadastrar Nova Sala
            </h5>
            <button
              class="btn-close"
              type="button"
              data-coreui-dismiss="modal"
              aria-label="Fechar"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="nome" class="form-label">Nome da Sala:</label>
              <input
                class="form-control"
                id="nome"
                name="nome"
                type="text"
                placeholder="Ex: M1, Lab Qu√≠mica"
                required
              />
            </div>
            <div class="mb-3">
              <label for="capacidade" class="form-label"
                >Capacidade M√°xima:</label
              >
              <input
                class="form-control"
                id="capacidade"
                name="capacidade"
                type="number"
                min="1"
                placeholder="Ex: 30"
                required
              />
            </div>
            <div class="mb-3">
              <label for="localizacao" class="form-label"
                >Localiza√ß√£o (Bloco):</label
              >
              <input
                class="form-control"
                id="localizacao"
                name="localizacao"
                type="text"
                placeholder="Ex: Bloco A, Pr√©dio Principal"
              />
            </div>
            <div class="mb-3">
              <label for="descricao" class="form-label">Descri√ß√£o:</label>
              <textarea
                class="form-control"
                id="descricao"
                name="descricao"
                rows="3"
                placeholder="Ex: Laborat√≥rio de inform√°tica com 30 PCs."
              ></textarea>
            </div>
            <div class="mb-3">
              <label for="recursos" class="form-label">Recursos:</label>
              <input
                class="form-control"
                id="recursos"
                name="recursos"
                type="text"
                placeholder="Ex: Projetor, Quadro Branco, Ar Condicionado"
              />
            </div>
          </div>
          <div class="modal-footer">
            <button
              class="btn btn-secondary"
              type="button"
              data-coreui-dismiss="modal"
            >
              Fechar
            </button>
            <button class="btn btn-primary" type="submit">Salvar Sala</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div
    class="modal fade"
    id="modalDetalhesSala"
    tabindex="-1"
    aria-labelledby="modalDetalhesSalaLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalDetalhesSalaLabel">
            <span id="detalheNomeModal"></span>
          </h5>
          <button
            class="btn-close"
            type="button"
            data-coreui-dismiss="modal"
            aria-label="Fechar"
          ></button>
        </div>
        <div class="modal-body">
          <p><strong>Nome:</strong> <span id="detalheNome"></span></p>
          <p><strong>Descri√ß√£o:</strong> <span id="detalheDescricao"></span></p>
          <p>
            <strong>Capacidade:</strong> <span id="detalheCapacidade"></span>
          </p>
          <p><strong>Recursos:</strong> <span id="detalheRecursos"></span></p>
          <p>
            <strong>Localiza√ß√£o:</strong> <span id="detalheLocalizacao"></span>
          </p>
        </div>
        <div class="modal-footer">
          {% if tipo_usuario == 'ADMINISTRADOR' %}
          <button class="btn btn-warning" id="btnEditarSala">Editar</button>
          <button class="btn btn-danger" id="btnExcluirSala">Excluir</button>
          {% endif %}
          <button
            class="btn btn-secondary"
            type="button"
            data-coreui-dismiss="modal"
          >
            Fechar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // 1. Script de Cadastro (Mantido)
    const form = document.getElementById("formCadastroSala");
    // ... (restante do c√≥digo do form de cadastro) ...
    if (form) {
      form.addEventListener("submit", async function (event) {
        event.preventDefault();
        const formData = new FormData(form);
        const data = {};
        formData.forEach(
          (value, key) =>
            (data[key] = key === "capacidade" ? parseInt(value) : value || null)
        );

        try {
          const response = await fetch("/api/v1/salas", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          if (!response.ok) {
            const err = await response.json();
            throw new Error(err.detail || `Erro HTTP ${response.status}`);
          }

          const result = await response.json();
          alert(`Sala "${result.nome}" cadastrada com sucesso!`);

          const modalEl = document.getElementById("modalCadastroSala");
          const modal =
            coreui.Modal.getInstance(modalEl) || new coreui.Modal(modalEl);
          modal.hide();

          window.location.reload();
        } catch (err) {
          console.error(err);
          alert("Falha no cadastro: " + err.message);
        }
      });
    }

    // 2. Script para o Modal de Detalhes Din√¢mico
    const detalhesModal = document.getElementById("modalDetalhesSala");
    if (detalhesModal) {
      detalhesModal.addEventListener("show.coreui.modal", function (event) {
        const card = event.relatedTarget; // O card que foi clicado

        // Extrai as informa√ß√µes dos data-attributes
        const nome = card.getAttribute("data-sala-nome");
        const capacidade = card.getAttribute("data-sala-capacidade");
        const localizacao = card.getAttribute("data-sala-localizacao");
        const recursos = card.getAttribute("data-sala-recursos");
        const descricao = card.getAttribute("data-sala-descricao");
        // Assumindo que voc√™ tem um ID √∫nico da sala:
        // const salaId = card.getAttribute('data-sala-id');

        // Atualiza o T√≠tulo do Modal e o corpo
        document.getElementById("detalheNomeModal").textContent = nome;

        document.getElementById("detalheNome").textContent = nome;
        document.getElementById("detalheCapacidade").textContent =
          capacidade + " pessoas";
        document.getElementById("detalheLocalizacao").textContent = localizacao;
        document.getElementById("detalheRecursos").textContent = recursos;
        document.getElementById("detalheDescricao").textContent = descricao;

        // Se for ADMINISTRADOR, voc√™ pode atualizar os bot√µes de a√ß√£o:
        /*
            {% if tipo_usuario == 'ADMINISTRADOR' %}
            const btnEditar = document.getElementById('btnEditarSala');
            const btnExcluir = document.getElementById('btnExcluirSala');
            
            // Exemplo: Atualizar links ou data-attributes para as a√ß√µes
            // btnEditar.onclick = () => window.location.href = `/salas/editar/${salaId}`;
            // btnExcluir.setAttribute('data-sala-id', salaId);
            {% endif %}
            */
      });
    }
  });
</script>

{% endblock %}
